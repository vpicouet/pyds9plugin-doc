{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"DS9 Quick look Plug-in pyDS9plugin is the first open source pythonic SAOImageDS9 quick look plugin. SAOImage DS9 is an astronomical imaging and data visualization application. Its 30 years of development has made it very stable and easy to use. This made it an essential tool in all fields of astronomy (observation, simulation, instrumentation). Much more profitable but pretty unsung feature, its extensibility makes it a limitless tool to interact with astronomical data. This extensibility did not generate a large collaborative and well organized effort to develop important extensions that could progressively converge towards a stable/rapid/configurable multi-extension DS9 package. Because I am convince of its interest, this extension is a very naive attempt to try initiate this tendency and explore the different possibilities. The goal is the pyds9plugin is then three-fold: Boosting the way we interact with scientific images in a quantitative way to earn important time Try to bring the visualization software DS9 a step further by combining it to image processing tools Create a code collaboration catalyst by providing a first extensive package gathering a glimpse of all the possibilities that offers DS9 extensibility","title":"Home"},{"location":"concept/","text":"A Pythonic package For all the reasons cited above, we decided to create the first Pythonic DS9 plugin: pyds9plugin . It is a public domain DS9 extension for quick-look image processing. It aims to extract quantifiable information from imaging datasets with improved interaction. The plugin processing functions can then be generalized automatically to a set of images to turn the quick-look tool into a multiprocessing pipeline. It enables new users, from undergraduate students to full-time researchers, to actively interact (process, model, plot, etc.) with astronomical image data with one integrated software package. This package, available both on Pypi and GitHub , has been extensively used within the FIREBall project and for CLAUDS catalogs generation. Before going any further, I highly recommend watching this youtube video for a better understanding of the package. The other videos that are linked in the document to present some functionality are all gathered here . The way it works DS9 incorporates the possibility to load extensions via an analysis file . When the plugin is installed and the analysis file loaded into the DS9 analysis menu, the extension can be used. The analysis file is the interface linking DS9 GUI with the plugin's functions. This file determines what menu is created within DS9 , what parameters windows each function launches, and what Shell command is interpreted. An example parameter window is shown in next Figure. Each pyds9plugin function is stored under DS9Utils access point, which links to pyds9plugin.DS9Utils module. Then command lines begin by DS9Utils followed by the function to be called and its arguments. pyds9plugin will then communicate, control, and exchange data with DS9 GUI via pyds9 package. The way the extension operates is illustrated in next. Communication Within the DS9 program, the XPA (X Public Access) messaging system has been designed to provide seamless communication between DS9 GUI and other Unix programs (Perl, Tcl/Tk). It also provides an easy way for users to communicate with DS9 by executing XPA client shell commands. The pyds9 module uses a Python interface for XPA to communicate with DS9 . It supports communication with all of DS9 's XPA access points in two ways. It enables read and write access to all DS9 parameters, which allows controlling the display (load images, display NumPy arrays and catalogs, change parameters, create regions / DS9 plots, etc.). One interest in using Python is to use the full capability of its famous packages such as matplotlib , which offers other possibilities than the DS9 native plotting GUI. Running a function All the functions are directly accessible from DS9 GUI (within the analysis menu). Accessing a function will make appear a parameter window that will then call the plugin. Navigating through the list of DS9Utils functions can be quite cumbersome for newcomers. OSX built-in Command Finder / Launcher provides an expeditive alternative that allows retrieving commands extremely fast. Some fundamental functions are available through shortcuts to gain time. The shortcuts are noted between parenthesis next to the function's name. The functions having a shortcut are: Open (o), lock (l), radial profile (r). Logging and verbosity The functions are silent when launched from DS9 and will only return nominal outputs (images, regions, messages). If the code encounters an error, the error message will pop up. If you run the same command from the terminal, you will have, in addition, all the verbosity from pyds9plugin . On top of that, all the logging is saved in \\(\\sim\\) /DS9QuickLookPlugIn/pyds9plugin_activity.log whether the function is launched from the terminal or DS9 user interface.","title":"Concept and implementation"},{"location":"concept/#a-pythonic-package","text":"For all the reasons cited above, we decided to create the first Pythonic DS9 plugin: pyds9plugin . It is a public domain DS9 extension for quick-look image processing. It aims to extract quantifiable information from imaging datasets with improved interaction. The plugin processing functions can then be generalized automatically to a set of images to turn the quick-look tool into a multiprocessing pipeline. It enables new users, from undergraduate students to full-time researchers, to actively interact (process, model, plot, etc.) with astronomical image data with one integrated software package. This package, available both on Pypi and GitHub , has been extensively used within the FIREBall project and for CLAUDS catalogs generation. Before going any further, I highly recommend watching this youtube video for a better understanding of the package. The other videos that are linked in the document to present some functionality are all gathered here .","title":"A Pythonic package"},{"location":"concept/#the-way-it-works","text":"DS9 incorporates the possibility to load extensions via an analysis file . When the plugin is installed and the analysis file loaded into the DS9 analysis menu, the extension can be used. The analysis file is the interface linking DS9 GUI with the plugin's functions. This file determines what menu is created within DS9 , what parameters windows each function launches, and what Shell command is interpreted. An example parameter window is shown in next Figure. Each pyds9plugin function is stored under DS9Utils access point, which links to pyds9plugin.DS9Utils module. Then command lines begin by DS9Utils followed by the function to be called and its arguments. pyds9plugin will then communicate, control, and exchange data with DS9 GUI via pyds9 package. The way the extension operates is illustrated in next.","title":"The way it works"},{"location":"concept/#communication","text":"Within the DS9 program, the XPA (X Public Access) messaging system has been designed to provide seamless communication between DS9 GUI and other Unix programs (Perl, Tcl/Tk). It also provides an easy way for users to communicate with DS9 by executing XPA client shell commands. The pyds9 module uses a Python interface for XPA to communicate with DS9 . It supports communication with all of DS9 's XPA access points in two ways. It enables read and write access to all DS9 parameters, which allows controlling the display (load images, display NumPy arrays and catalogs, change parameters, create regions / DS9 plots, etc.). One interest in using Python is to use the full capability of its famous packages such as matplotlib , which offers other possibilities than the DS9 native plotting GUI.","title":"Communication"},{"location":"concept/#running-a-function","text":"All the functions are directly accessible from DS9 GUI (within the analysis menu). Accessing a function will make appear a parameter window that will then call the plugin. Navigating through the list of DS9Utils functions can be quite cumbersome for newcomers. OSX built-in Command Finder / Launcher provides an expeditive alternative that allows retrieving commands extremely fast. Some fundamental functions are available through shortcuts to gain time. The shortcuts are noted between parenthesis next to the function's name. The functions having a shortcut are: Open (o), lock (l), radial profile (r).","title":"Running a function"},{"location":"concept/#logging-and-verbosity","text":"The functions are silent when launched from DS9 and will only return nominal outputs (images, regions, messages). If the code encounters an error, the error message will pop up. If you run the same command from the terminal, you will have, in addition, all the verbosity from pyds9plugin . On top of that, all the logging is saved in \\(\\sim\\) /DS9QuickLookPlugIn/pyds9plugin_activity.log whether the function is launched from the terminal or DS9 user interface.","title":"Logging and verbosity"},{"location":"feature/","text":"Important features Command line access As expressed above, DS9 will execute a Shell command, which will call the package's functions. DS9 allows prompting this command each time a function is launched through: Analysis -> Analysis command log . Copy-pasting this command into a Shell interpreter (like Terminal) will provide the same result. The package is then totally accessible via a Shell interpreter via command lines. This important feature could allow the plugin to be operated from other image visualization software like Ginga or Glueviz. Running DS9Utils inside the terminal will show all the available functions and running DS9Utils <function> -h will display the help (Figure [ds9/DS9Utils.jpg] ) of the related function. This leads to the next major feature: multi-image analysis. All functions arguments are parsed through the argparse module. Functions can then be called from DS9 , terminal or directly from Python using argv parameter: \\( \\(\\verb! Python_command(argv=\"-p '/data/**/*.fits' -e 'ds9-=1'\")! \\label{eq:Python}\\) \\) Multi-image and multi-threaded analysis pyds9plugin is, in essence, a quick-look plugin that is perfect for visualizing, exploring, analyzing, and processing the displayed image. However, it was essential to make it suitable for more important pipelines as soon as the parameters have been tuned. To this end, all processing functions can be launched on a set of images by specifying the path of all the images using regular expression: DS9Utils <function> [-o OPTIONAL] --path \"/data/**/*.fits\" This feature allows, for instance, to spend important time optimizing interactively the \\(\\sim50\\) parameters of source extraction and add a whole image folder to the analysis command to process all the images when the parameters have been fine-tuned. To take advantage of modern computer architectures, it uses multi-threading to run each image on a different thread. The number of processors to be used is accessible via -N or --number_processors argument. By default, the code will use the total number of processors of the machine minus 2. A video can be found . Python interpreter We added a Python interpreter to the extension. This allows directly applying Pythonic one-line transformations to the displayed image. We list below some of the numerous one-line possibilities that can, for instance, be used for generating some noise images, apply linear transformation to images to decrease artificially your exposure time for instance), add noise to your image, mask bright sources, or perform more complex transformations like fast Fourier transform or auto-correlation. DS9 = np.median(ds9) + 0.1 (ds9-np.median(ds9)) ds9+=np.random.normal(0,0.5*ds9.std(),size=ds9.shape) ds9+=np.random.normal(0,0.5*ds9.std(),size=ds9.shape) ds9[ds9>np.percentile(ds9,99)]=np.nan ds9=abs(fftshift(fft2(ds9)))**2 ds9=correlate2d(ds9,ds9,boundary='symm', mode='same') Python macros Because one line is short, it is possible to simply give the path of a Python file. For instance, giving the path of the code below interpolates masked values in the DS9 frame and returns the new image in the DS9 GUI: \\ Basically, any function that does not require user's parameters can be directly implemented this way which is simpler as multiprocessing is already implemented. As well as for the previous section, the defined function can be run on a set of images by adding the regular expression path to the --path parameter (see Section 3.1.2 and ): DS9Utils python_command --exp \"/softs/pipe.py\" -p \"/data/**/*.fits\" The different variables that can be used inside macros are ds9 for the image loaded in DS9 and header for its header and d is the XPA access point for a more extensive communication with DS9 . Following lessons learned from @Joye2005, I decided to include in DS9 analysis functions only the ones that are generic/helpful and that require input parameters. Functions that do not require any parameter should be implemented as macros as multiprocessing is already implemented. To help people write their own, I published within the plugin several macros (in DS9functions/macros ). Each macro ( FFT.py , Autocorrelation.py , trimming.py , Column_line_correlation.py , Interpolate_NaNs.py , etc.) can either contain one specific task (compute and return the FFT of the DS9 image, trim wcs images, interpolate masked values in the image, etc.) or a series of processing (background subtraction source extraction astrometric calibration) from astropy.convolution import interpolate_replace_nans, Gaussian2DKernel STD_DEV = 1 while ~np.isfinite(ds9).all(): kernel = Gaussian2DKernel(x_stddev=STD_DEV, y_stddev=STD_DEV) \\texttt{DS9} = interpolate_replace_nans(ds9, kernel) STD_DEV += 1 VTK 3D rendering The Visualization Toolkit ( VTK ) is the leading open-source software for manipulating and displaying scientific data. It comes with state-of-the-art tools for 3D rendering, a suite of widgets for 3D interaction, and is already supported by some of the other applications ( JS9 , Icy , AstroImageJ ). We integrated it into the plugin to increase the interaction with selected regions in the image. The function allows to add contours, smooth the image rendering, change the scale, or create a rotating .gif video. Possibility to even fit interactively 2D Gaussians. It is also possible to analyze time series in 3D like through-focus or to explore the focus in the field. Interactive profile fitting DS9 incorporates the very useful possibility to interactively plot 1D profiles (can be tilted, stacked in the orthogonal direction, plot the third axis component, etc). This gives essential qualitative information. Because it is essential to retrieve information from images (spatial/spectral resolution, diffusion exponential decay, etc.) it is critical to turn this qualitative information into re-usable quantitative information. To do this we added an interactive plot fitter to the extension (based on the dataphile package). This allows fitting 1-D profiles with interactive adjustment of the initial guess parameters to ensure that the fit converges. This function works on any DS9 plot, which means that plots generated via the plugin (radial profile or light curve) can be fitted with this function. As multi-feature analysis is essential in astronomy, the fitting is decomposed into two components: the background and the features added to the background. The different background possibles are constant, slope, exponential, double-exponential, logarithmic. It is then possible to add any number of features among Gaussian, Voigt, or Moffat profiles (see Figure [ds9/fit2d.jpg] ). Each feature parameter can be moved independently to be sure that the final fit converges. The definition of the different functions is shown in table 1 . To get the most of this fitting function, we added the possibility to add any other user-defined functions. The function just needs to be added to the package file:\\ pyds9plugin/Macros/Fitting_Functions/functions.py For each fitted parameter, be sure to define a list as default argument as it will be used to define the lower and upper bounds of the widget fitter. Function Formula Constant \\(y = a\\) Slope \\(y=a \\times x\\) Exponential \\(y=a\\times e^{-\\frac{x}{b}}\\) Logarithmic \\(y=a + b\\times ln(x-c)\\) Double exponential \\(y=a\\times e^{-\\frac{x}{b}} + c\\times e^{-\\frac{x}{d}}\\) Gaussian \\(y=a \\times e^{-(\\frac{c-b}{2*c})^2}\\) Moffat \\(y=a\\times (1 + \\frac{x-b}{c}^{2})^{-d}\\) Voight \\(y=a \\times\\frac{ \\mathbb{R}\\left ( wofz \\left ( \\frac{(x-b) \\gamma i}{c\\sqrt{\\pi}} \\right ) \\right ) }{ \\mathbb{R}\\left ( wofz \\left ( \\frac{x \\gamma i}{c\\sqrt{\\pi}} \\right ) \\right ) }\\) Fitting functions of the profile fitter. The first four functions are the possible backgrounds to fit. On top of this background, you can add as many Gaussian/Moffat/Voigt features as you want. The wofz function in the last line is the Faddeeva function \\(wofz(z)=e^{-z^2} \\times (1-erf(-iz) )\\) accessible in Python via scipy.special.wofz If no plot neither catalog is given, the window will work as a regular plotter, where the user can plot its own function and change the parameters. Fits file organizer This final functionality is a fits organizer, divided into two functions (Create header database and Filtering and organizing images). The first function generates from the input images (regular expression) a catalog (CSV table) concatenating all information contained in the header images. It will also add important information such as the path, directory, basename, creation and modification date, size, etc. of each image. The output database will give at a glance all image information which will help understand the dataset, spot failures in the acquisition, etc. It can also be open with TOPCAT to perform more complex analysis and selection of images (See figure [ds9/files.jpg] ) As only header information is read (not the pixels), the function is fast even on a significant number of files (a few seconds for thousands of files). Still, it can be very interesting to add to the output header catalog some image information such as the images' median, noise, the number of saturated pixels, or any other information. To this end, the function accepts Header catalog Macros where the user can write any Python command to append image estimators to the output header catalog. For instance, the following piece of code add to the header database some information about the image (column/line correlation, saturated pixels fraction, number of cosmic rays, etc.): import numpy as np SATURATION = 2 ** 16 -1 data = fitsfile[0].data columns = np.nanmean(data, axis=1) lines = np.nanmean(data, axis=0) table['median'] = np.nanmedian(data) table[\"Lines_difference\"] = np.nanmedian(lines[::2]) - np.nanmedian(lines[1::2]) table[\"Columns_difference\"] = np.nanmedian(columns[::2]) - np.nanmedian(columns[1::2]) table[\"SaturatedPixels\"] = 100 * np.mean(data > SATURATION) table[\"CosmicRays\"] = count_cosmic_rays(data) The output header database can be used with the second function, which filters the images and organizes them following organizational rules. This function allows creating subsets of images verifying some header conditions. For instance, all images created after the 12th of September 2020 that have a positive EMGAIN or an exposure higher than 100 seconds can be recovered with this condition: \\( \\(\\renewcommand{\\theequation}{6} \\verb! (EMGAIN > 0 | EXPOSURE >100) & CreationTime>200912 ! \\label{eq:selection}\\) \\) The files are then directly organized in the file system with an arborescence following the column names. For instance, by giving EMGAIN,EXPOSURE , all files will get organized as shown in figure [ds9/filter_files.jpg] . A video can be found . The function only generates aliases and does not move any original files. The header database and organized aliases are respectively saved in \\(\\sim\\) /DS9QuickLookPlugIn/HeaderDataBase and \\(\\sim\\) /DS9QuickLookPlugIn/subsets . The different functions The functions are divided into three categories to help the organization (see Figure [ds9/commands.jpg] ):\\ Generic functions, instrumentation-related functions, and astronomical-software-related functions. To make more accessible the understanding of each function, they are possibly prefixed by three badges:\\ Boosting interaction: These functions are considered to improve the interactivity between the user and the visualized data. This interaction can be based on user-defined regions, interactive fitting, generation of pickable metadata, etc. DS9 not required: The function is totally accessible via Terminal independently from DS9 , which means that the function does not need DS9 to be installed/open for being called. This can be interesting for server users. Multi-image processing: The function, accessible via Shell command, can be run on several images, and each analysis will run on a different thread (See section 3.1.2 ) Generic functions This series of very general functions aims at filling some gaps of DS9 with stable generic functions (fitting, region-based functions), gaining some time with key functions: (change display settings/lock parameters), etc. Change Display Parameters This basic function applies specific thresholding, scale, and colormap to the DS9 -loaded image to give a quick and general visualization of the image. Accessible via one key hit (S), this allows exploring the full depth of the image quickly. More interestingly, the user can focus on a specific region of the image by creating and selecting a box or a circle on the region of interest (). Lock / Unlock Frames Access all the locking parameters of DS9 frames at once to gain time: frame, crosshair, smooth, scale-limits, colorbar. Create Header DataBase Creates a catalog combining all meta-data information. Filtering & organizing images Uses fits file database to create and order nicely filtered fits files (Section 3.1.7 ) Macro / Python Command Interprets a Python command or file and applies it to given image(s) (Sections 3.1.3 and 3.1.4 ) Interactive 1D Fitting On Plot Fit interactively any DS9 plot or catalog by different pre-defined functions (Section 3.1.6 ) Fit Gaussian 2D Performs 2D Gaussian fitting on the encircled region in DS9. Opens up a VTK 3D plot of the encircled data. Any other feature can be fitted by selecting it (r). Each fit creates a region on the DS9 GUI with the fit parameters of astropy.modeling.functional_models.Gaussian2D (). Trimming Cropping/Trimming function that keeps WCS header information. Open file(s) in DS9 in an easier way. Possibility to enter the path of an image and a regular expression to open multiple files. Files can be open in the following format: Slice, Multi-frame-as-cube, multi-frame, RGB, Cube, PRISM. Plot Region In 3D See Section 3.1.5 , and Figures 1 and [ds9/3d3d.jpg] Convert image Convert file into another type. The different types are (int8, int16, int32, int64, float32, float64) with the possibiity to rescale pixels value. Instrumentation This series of functions aims to assist instrument researchers during assembly and testing with through-focus, light curves, centering, radial, energy profile analysis, etc. More complex but general processing functions (for detector characterization, for instance) can be found in the macros (See section 3.1.4 ) like auto-correlation, fast Fourier transform, smoothing, masking, interpolation, noise measurements, etc. Centering (C) Centers DS9 region encircling a spot. Five centroid methods are available: maximum, \\(2\\times1\\) 1D fittin, 2D fitting, barycenter). Radial profile Compute and plot azimuthally averaged radial profile and energy profile of the encircled source in DS9 after performing a re-centering. For extended sources, the source size can be informed to deconvolve the radial profile from the source (Figure [ds9/radial.jpg] ). Throughfocus analysis Perform a through-focus analysis on a series of images and return different focus estimates as well as the 3D evolution of the PSF (Figure [ds9/throughfocus.jpg] ). Explore PSFs/vignettes Explore PSFs/vignettes based on SExtractor catalog to visualize how it evolves in the field or with FWHM, magnitude, excentricity, angle or amplitude. Light curve Perform a light-curve analysis and returns the centered image. Extract Sources Extract sources from images(s) using photutils [@Bradley2016] Subtract Background Subtract background from images(s) using photutils Aperture photometry Computes photometry in given aperture(s) Astronomical software The goal of this series of functions is to link the most essential astronomical image processing software like the astromatic suite ( SExtractor , Stiff , Swarp , PSFex - need to be installed) and offer them a parameter GUI. Astrometric Calibration Uses astrometry.net to compute position on the sky and return WCS header. If regions are created (by hand or via SExtractor ) and the parameter XY-catalog is set, only the position of the sources will be uploaded (). STIFF - Color Images Run STIFF astromatic software [@Bertin2011a] to convert scientific FITS images to the more popular TIFF format for illustration purposes (). PSFex Run PSFex astromatic software [@Bertin2011] to extracts models of the Point Spread Function from FITS images processed with SExtractor , and measures the quality of images. The generated PSF models can be used for model-fitting photometry or morphological analyses. SExtractor Run SExtraxtor astromatic software [@Bertinl1996] to build a catalogue of objects from an astronomical image (Figure [ds9/sex.jpg] ). Swarp Run Swarp software from DS9 [@Bertin2010] to resample and co-add together FITS images using any astrometric projection defined in the WCS standard. Resample images Run part of Swarp astromatic software for resampling without co-addition.","title":"Important features"},{"location":"feature/#important-features","text":"","title":"Important features"},{"location":"feature/#command-line-access","text":"As expressed above, DS9 will execute a Shell command, which will call the package's functions. DS9 allows prompting this command each time a function is launched through: Analysis -> Analysis command log . Copy-pasting this command into a Shell interpreter (like Terminal) will provide the same result. The package is then totally accessible via a Shell interpreter via command lines. This important feature could allow the plugin to be operated from other image visualization software like Ginga or Glueviz. Running DS9Utils inside the terminal will show all the available functions and running DS9Utils <function> -h will display the help (Figure [ds9/DS9Utils.jpg] ) of the related function. This leads to the next major feature: multi-image analysis. All functions arguments are parsed through the argparse module. Functions can then be called from DS9 , terminal or directly from Python using argv parameter: \\( \\(\\verb! Python_command(argv=\"-p '/data/**/*.fits' -e 'ds9-=1'\")! \\label{eq:Python}\\) \\)","title":"Command line access"},{"location":"feature/#multi-image-and-multi-threaded-analysis","text":"pyds9plugin is, in essence, a quick-look plugin that is perfect for visualizing, exploring, analyzing, and processing the displayed image. However, it was essential to make it suitable for more important pipelines as soon as the parameters have been tuned. To this end, all processing functions can be launched on a set of images by specifying the path of all the images using regular expression: DS9Utils <function> [-o OPTIONAL] --path \"/data/**/*.fits\" This feature allows, for instance, to spend important time optimizing interactively the \\(\\sim50\\) parameters of source extraction and add a whole image folder to the analysis command to process all the images when the parameters have been fine-tuned. To take advantage of modern computer architectures, it uses multi-threading to run each image on a different thread. The number of processors to be used is accessible via -N or --number_processors argument. By default, the code will use the total number of processors of the machine minus 2. A video can be found .","title":"Multi-image and multi-threaded analysis"},{"location":"feature/#python-interpreter","text":"We added a Python interpreter to the extension. This allows directly applying Pythonic one-line transformations to the displayed image. We list below some of the numerous one-line possibilities that can, for instance, be used for generating some noise images, apply linear transformation to images to decrease artificially your exposure time for instance), add noise to your image, mask bright sources, or perform more complex transformations like fast Fourier transform or auto-correlation. DS9 = np.median(ds9) + 0.1 (ds9-np.median(ds9)) ds9+=np.random.normal(0,0.5*ds9.std(),size=ds9.shape) ds9+=np.random.normal(0,0.5*ds9.std(),size=ds9.shape) ds9[ds9>np.percentile(ds9,99)]=np.nan ds9=abs(fftshift(fft2(ds9)))**2 ds9=correlate2d(ds9,ds9,boundary='symm', mode='same')","title":"Python interpreter"},{"location":"feature/#python-macros","text":"Because one line is short, it is possible to simply give the path of a Python file. For instance, giving the path of the code below interpolates masked values in the DS9 frame and returns the new image in the DS9 GUI: \\ Basically, any function that does not require user's parameters can be directly implemented this way which is simpler as multiprocessing is already implemented. As well as for the previous section, the defined function can be run on a set of images by adding the regular expression path to the --path parameter (see Section 3.1.2 and ): DS9Utils python_command --exp \"/softs/pipe.py\" -p \"/data/**/*.fits\" The different variables that can be used inside macros are ds9 for the image loaded in DS9 and header for its header and d is the XPA access point for a more extensive communication with DS9 . Following lessons learned from @Joye2005, I decided to include in DS9 analysis functions only the ones that are generic/helpful and that require input parameters. Functions that do not require any parameter should be implemented as macros as multiprocessing is already implemented. To help people write their own, I published within the plugin several macros (in DS9functions/macros ). Each macro ( FFT.py , Autocorrelation.py , trimming.py , Column_line_correlation.py , Interpolate_NaNs.py , etc.) can either contain one specific task (compute and return the FFT of the DS9 image, trim wcs images, interpolate masked values in the image, etc.) or a series of processing (background subtraction source extraction astrometric calibration) from astropy.convolution import interpolate_replace_nans, Gaussian2DKernel STD_DEV = 1 while ~np.isfinite(ds9).all(): kernel = Gaussian2DKernel(x_stddev=STD_DEV, y_stddev=STD_DEV) \\texttt{DS9} = interpolate_replace_nans(ds9, kernel) STD_DEV += 1","title":"Python macros"},{"location":"feature/#vtk-3d-rendering","text":"The Visualization Toolkit ( VTK ) is the leading open-source software for manipulating and displaying scientific data. It comes with state-of-the-art tools for 3D rendering, a suite of widgets for 3D interaction, and is already supported by some of the other applications ( JS9 , Icy , AstroImageJ ). We integrated it into the plugin to increase the interaction with selected regions in the image. The function allows to add contours, smooth the image rendering, change the scale, or create a rotating .gif video. Possibility to even fit interactively 2D Gaussians. It is also possible to analyze time series in 3D like through-focus or to explore the focus in the field.","title":"VTK 3D rendering"},{"location":"feature/#interactive-profile-fitting","text":"DS9 incorporates the very useful possibility to interactively plot 1D profiles (can be tilted, stacked in the orthogonal direction, plot the third axis component, etc). This gives essential qualitative information. Because it is essential to retrieve information from images (spatial/spectral resolution, diffusion exponential decay, etc.) it is critical to turn this qualitative information into re-usable quantitative information. To do this we added an interactive plot fitter to the extension (based on the dataphile package). This allows fitting 1-D profiles with interactive adjustment of the initial guess parameters to ensure that the fit converges. This function works on any DS9 plot, which means that plots generated via the plugin (radial profile or light curve) can be fitted with this function. As multi-feature analysis is essential in astronomy, the fitting is decomposed into two components: the background and the features added to the background. The different background possibles are constant, slope, exponential, double-exponential, logarithmic. It is then possible to add any number of features among Gaussian, Voigt, or Moffat profiles (see Figure [ds9/fit2d.jpg] ). Each feature parameter can be moved independently to be sure that the final fit converges. The definition of the different functions is shown in table 1 . To get the most of this fitting function, we added the possibility to add any other user-defined functions. The function just needs to be added to the package file:\\ pyds9plugin/Macros/Fitting_Functions/functions.py For each fitted parameter, be sure to define a list as default argument as it will be used to define the lower and upper bounds of the widget fitter. Function Formula Constant \\(y = a\\) Slope \\(y=a \\times x\\) Exponential \\(y=a\\times e^{-\\frac{x}{b}}\\) Logarithmic \\(y=a + b\\times ln(x-c)\\) Double exponential \\(y=a\\times e^{-\\frac{x}{b}} + c\\times e^{-\\frac{x}{d}}\\) Gaussian \\(y=a \\times e^{-(\\frac{c-b}{2*c})^2}\\) Moffat \\(y=a\\times (1 + \\frac{x-b}{c}^{2})^{-d}\\) Voight \\(y=a \\times\\frac{ \\mathbb{R}\\left ( wofz \\left ( \\frac{(x-b) \\gamma i}{c\\sqrt{\\pi}} \\right ) \\right ) }{ \\mathbb{R}\\left ( wofz \\left ( \\frac{x \\gamma i}{c\\sqrt{\\pi}} \\right ) \\right ) }\\) Fitting functions of the profile fitter. The first four functions are the possible backgrounds to fit. On top of this background, you can add as many Gaussian/Moffat/Voigt features as you want. The wofz function in the last line is the Faddeeva function \\(wofz(z)=e^{-z^2} \\times (1-erf(-iz) )\\) accessible in Python via scipy.special.wofz If no plot neither catalog is given, the window will work as a regular plotter, where the user can plot its own function and change the parameters.","title":"Interactive profile fitting"},{"location":"feature/#fits-file-organizer","text":"This final functionality is a fits organizer, divided into two functions (Create header database and Filtering and organizing images). The first function generates from the input images (regular expression) a catalog (CSV table) concatenating all information contained in the header images. It will also add important information such as the path, directory, basename, creation and modification date, size, etc. of each image. The output database will give at a glance all image information which will help understand the dataset, spot failures in the acquisition, etc. It can also be open with TOPCAT to perform more complex analysis and selection of images (See figure [ds9/files.jpg] ) As only header information is read (not the pixels), the function is fast even on a significant number of files (a few seconds for thousands of files). Still, it can be very interesting to add to the output header catalog some image information such as the images' median, noise, the number of saturated pixels, or any other information. To this end, the function accepts Header catalog Macros where the user can write any Python command to append image estimators to the output header catalog. For instance, the following piece of code add to the header database some information about the image (column/line correlation, saturated pixels fraction, number of cosmic rays, etc.): import numpy as np SATURATION = 2 ** 16 -1 data = fitsfile[0].data columns = np.nanmean(data, axis=1) lines = np.nanmean(data, axis=0) table['median'] = np.nanmedian(data) table[\"Lines_difference\"] = np.nanmedian(lines[::2]) - np.nanmedian(lines[1::2]) table[\"Columns_difference\"] = np.nanmedian(columns[::2]) - np.nanmedian(columns[1::2]) table[\"SaturatedPixels\"] = 100 * np.mean(data > SATURATION) table[\"CosmicRays\"] = count_cosmic_rays(data) The output header database can be used with the second function, which filters the images and organizes them following organizational rules. This function allows creating subsets of images verifying some header conditions. For instance, all images created after the 12th of September 2020 that have a positive EMGAIN or an exposure higher than 100 seconds can be recovered with this condition: \\( \\(\\renewcommand{\\theequation}{6} \\verb! (EMGAIN > 0 | EXPOSURE >100) & CreationTime>200912 ! \\label{eq:selection}\\) \\) The files are then directly organized in the file system with an arborescence following the column names. For instance, by giving EMGAIN,EXPOSURE , all files will get organized as shown in figure [ds9/filter_files.jpg] . A video can be found . The function only generates aliases and does not move any original files. The header database and organized aliases are respectively saved in \\(\\sim\\) /DS9QuickLookPlugIn/HeaderDataBase and \\(\\sim\\) /DS9QuickLookPlugIn/subsets .","title":"Fits file organizer"},{"location":"feature/#the-different-functions","text":"The functions are divided into three categories to help the organization (see Figure [ds9/commands.jpg] ):\\ Generic functions, instrumentation-related functions, and astronomical-software-related functions. To make more accessible the understanding of each function, they are possibly prefixed by three badges:\\ Boosting interaction: These functions are considered to improve the interactivity between the user and the visualized data. This interaction can be based on user-defined regions, interactive fitting, generation of pickable metadata, etc. DS9 not required: The function is totally accessible via Terminal independently from DS9 , which means that the function does not need DS9 to be installed/open for being called. This can be interesting for server users. Multi-image processing: The function, accessible via Shell command, can be run on several images, and each analysis will run on a different thread (See section 3.1.2 )","title":"The different functions"},{"location":"feature/#generic-functions","text":"This series of very general functions aims at filling some gaps of DS9 with stable generic functions (fitting, region-based functions), gaining some time with key functions: (change display settings/lock parameters), etc. Change Display Parameters This basic function applies specific thresholding, scale, and colormap to the DS9 -loaded image to give a quick and general visualization of the image. Accessible via one key hit (S), this allows exploring the full depth of the image quickly. More interestingly, the user can focus on a specific region of the image by creating and selecting a box or a circle on the region of interest (). Lock / Unlock Frames Access all the locking parameters of DS9 frames at once to gain time: frame, crosshair, smooth, scale-limits, colorbar. Create Header DataBase Creates a catalog combining all meta-data information. Filtering & organizing images Uses fits file database to create and order nicely filtered fits files (Section 3.1.7 ) Macro / Python Command Interprets a Python command or file and applies it to given image(s) (Sections 3.1.3 and 3.1.4 ) Interactive 1D Fitting On Plot Fit interactively any DS9 plot or catalog by different pre-defined functions (Section 3.1.6 ) Fit Gaussian 2D Performs 2D Gaussian fitting on the encircled region in DS9. Opens up a VTK 3D plot of the encircled data. Any other feature can be fitted by selecting it (r). Each fit creates a region on the DS9 GUI with the fit parameters of astropy.modeling.functional_models.Gaussian2D (). Trimming Cropping/Trimming function that keeps WCS header information. Open file(s) in DS9 in an easier way. Possibility to enter the path of an image and a regular expression to open multiple files. Files can be open in the following format: Slice, Multi-frame-as-cube, multi-frame, RGB, Cube, PRISM. Plot Region In 3D See Section 3.1.5 , and Figures 1 and [ds9/3d3d.jpg] Convert image Convert file into another type. The different types are (int8, int16, int32, int64, float32, float64) with the possibiity to rescale pixels value.","title":"Generic functions"},{"location":"feature/#instrumentation","text":"This series of functions aims to assist instrument researchers during assembly and testing with through-focus, light curves, centering, radial, energy profile analysis, etc. More complex but general processing functions (for detector characterization, for instance) can be found in the macros (See section 3.1.4 ) like auto-correlation, fast Fourier transform, smoothing, masking, interpolation, noise measurements, etc. Centering (C) Centers DS9 region encircling a spot. Five centroid methods are available: maximum, \\(2\\times1\\) 1D fittin, 2D fitting, barycenter). Radial profile Compute and plot azimuthally averaged radial profile and energy profile of the encircled source in DS9 after performing a re-centering. For extended sources, the source size can be informed to deconvolve the radial profile from the source (Figure [ds9/radial.jpg] ). Throughfocus analysis Perform a through-focus analysis on a series of images and return different focus estimates as well as the 3D evolution of the PSF (Figure [ds9/throughfocus.jpg] ). Explore PSFs/vignettes Explore PSFs/vignettes based on SExtractor catalog to visualize how it evolves in the field or with FWHM, magnitude, excentricity, angle or amplitude. Light curve Perform a light-curve analysis and returns the centered image. Extract Sources Extract sources from images(s) using photutils [@Bradley2016] Subtract Background Subtract background from images(s) using photutils Aperture photometry Computes photometry in given aperture(s)","title":"Instrumentation"},{"location":"feature/#astronomical-software","text":"The goal of this series of functions is to link the most essential astronomical image processing software like the astromatic suite ( SExtractor , Stiff , Swarp , PSFex - need to be installed) and offer them a parameter GUI. Astrometric Calibration Uses astrometry.net to compute position on the sky and return WCS header. If regions are created (by hand or via SExtractor ) and the parameter XY-catalog is set, only the position of the sources will be uploaded (). STIFF - Color Images Run STIFF astromatic software [@Bertin2011a] to convert scientific FITS images to the more popular TIFF format for illustration purposes (). PSFex Run PSFex astromatic software [@Bertin2011] to extracts models of the Point Spread Function from FITS images processed with SExtractor , and measures the quality of images. The generated PSF models can be used for model-fitting photometry or morphological analyses. SExtractor Run SExtraxtor astromatic software [@Bertinl1996] to build a catalogue of objects from an astronomical image (Figure [ds9/sex.jpg] ). Swarp Run Swarp software from DS9 [@Bertin2010] to resample and co-add together FITS images using any astrometric projection defined in the WCS standard. Resample images Run part of Swarp astromatic software for resampling without co-addition.","title":"Astronomical software"},{"location":"install/","text":"Installation pyds9plugin is governed by the CeCILL-B license under French law and abides by the rules of free software distribution. The package has been released on https://pypi.org and is being reviewed to become an astropy affiliated packages . The source code is available on GitHub: git clone https://GitHub.com/vpicouet/DS9functions.git People can contribute to the code via GitHub and fill issues with Github's issue tracker. pyds9plugin works with DS9 with a version equal to or higher than 8.2. The extension can be installed via the terminal: pip install -v pyds9plugin or Python setup.py install The package can also be installed inside a virtual environment . The package will be accessible via DS9Utils keyword in the terminal. To load the analysis file in DS9 run: DS9Utils LoadDS9QuickLookPlugin If the file can not be added automatically, instructions will appear to add it manually. Warning To do so copy the path returned by the previous command and add it to DS9 preference analysis section Prerequisites and dependence: pyds9plugin runs under Python versions \\(>3.5\\) . Note that as a minimum, any user will need to have at least installed pyds9 , NumPy , scipy , astropy , argparse , pyvista , tqdm , datetime , pandas , PyQt5 , matplotlib and dataphile . For full functionality the astromatic suite ( Swarp , Stiff and PSFex ) is also needed. Warning Pyds9 package is not available on windows.","title":"Installation"},{"location":"install/#installation","text":"pyds9plugin is governed by the CeCILL-B license under French law and abides by the rules of free software distribution. The package has been released on https://pypi.org and is being reviewed to become an astropy affiliated packages . The source code is available on GitHub: git clone https://GitHub.com/vpicouet/DS9functions.git People can contribute to the code via GitHub and fill issues with Github's issue tracker. pyds9plugin works with DS9 with a version equal to or higher than 8.2. The extension can be installed via the terminal: pip install -v pyds9plugin or Python setup.py install The package can also be installed inside a virtual environment . The package will be accessible via DS9Utils keyword in the terminal. To load the analysis file in DS9 run: DS9Utils LoadDS9QuickLookPlugin If the file can not be added automatically, instructions will appear to add it manually. Warning To do so copy the path returned by the previous command and add it to DS9 preference analysis section Prerequisites and dependence: pyds9plugin runs under Python versions \\(>3.5\\) . Note that as a minimum, any user will need to have at least installed pyds9 , NumPy , scipy , astropy , argparse , pyvista , tqdm , datetime , pandas , PyQt5 , matplotlib and dataphile . For full functionality the astromatic suite ( Swarp , Stiff and PSFex ) is also needed. Warning Pyds9 package is not available on windows.","title":"Installation"},{"location":"license/","text":"vincent@picouet.fr This software is a computer program whose purpose is to perform quicklook image processing and analysis. It can ionteract with SAOImage DS9 Software when loaded as an extension. This software is governed by the CeCILL-B license under French law and abiding by the rules of distribution of free software. You can use, modify and/ or redistribute the software under the terms of the CeCILL-B license as circulated by CEA, CNRS and INRIA at the following URL \"http://www.cecill.info\". As a counterpart to the access to the source code and rights to copy, modify and redistribute granted by the license, users are provided only with a limited warranty and the software's author, the holder of the economic rights, and the successive licensors have only limited liability. In this respect, the user's attention is drawn to the risks associated with loading, using, modifying and/or developing or reproducing the software by the user in light of its specific status of free software, that may mean that it is complicated to manipulate, and that also therefore means that it is reserved for developers and experienced professionals having in-depth computer knowledge. Users are therefore encouraged to load and test the software's suitability as regards their requirements in conditions enabling the security of their systems and/or data to be ensured and, more generally, to use and operate it in the same conditions as regards security. The fact that you are presently reading this means that you have had knowledge of the CeCILL-B license and that you accept its terms.","title":"License"},{"location":"philosophy/","text":"Motivation Current fits viewer applications ( SAOImage DS9 , Aladin , GINGA , Glue ) have been developed to optimize the visualization of astronomical images while keeping some interesting specificities: linked-data exploration, interactive sky atlas access, flexible and extensible visualization toolkit, etc. Not initially designed for image processing, these applications do not address this need as it would break their conceptual integrity (by dispersing their purpose). This leaves it to big instrument consortiums who will design their own data processing pipeline, which will, most of the time, be too specific to be re-used by the astronomy community. For the particular discipline of astronomy evolving towards Jim Gray's fourth paradigm and where an essential part of the job relies on image analysis, the lack of processing codes draws a new challenge for current and future imaging software: mimicking what has been done for bioimage analysis by addressing the current frontier of image processing. Among the different difficulties that need to be addressed to make the processing software beneficial (catalyzing community collaboration and code enhancement, multi-image analysis, extensibility), one key aspect is to keep the essential high-level interactivity between the data and the user, which became a consensual feature for visualization. For various reasons that I will present, the development of plugins for fits viewer applications represents an exciting way to take up the challenge of developing image processing tools and address the related difficulties. I will then use introduce pyds9plugin : an attempt to design such a plugin. This DS9 quick look plugin is a public domain versatile extension I designed for DS9 visualization software. The plugin pushes DS9 visualization software a step further by allowing to analyze and process in real-time images while keeping a high level of interactivity. The processing functions can then be generalized automatically to a set of images to turn the quick-look tool into a multiprocessing pipeline. This plugin incorporates essential functions (radial profile, 2D/3D fitting, trough-focus, stacking, background removal, source/artifact extraction, etc.) to extract quantitative and intelligible information from imaging datasets in order to support instrumentation, reduce observations, analyze data performance, etc. We also linked the most famous astronomical codes ( SExtractor , Swarp , etc.) to the plugin to allow research-grade analysis and processing. As all researchers have different needs, the plugin is designed intelligibly to allow everyone to add their own macros that can then be run quickly and automatically on a set of images thanks to multiprocessing. This pyds9plugin , available both on Pypi and Github, tries to gather a glimpse of all the possibilities that offers DS9 extensibility so that it motivates astronomers exploring this development approach. This hybrid chapter aims at giving an overview of the achieved work. Existing tools Existing tools, strengths and weaknesses The different main existing software for image visualization/processing are SAOImageDS9 , Aladin , Ginga and GlueViz . Some other non-astronomy-related image processing codes have developed astronomy plugins like ImageJ and Icy . Next Figure sum up each software approach and different characteristics as well as their different strengths and weaknesses in terms of image visualization and processing. On a total of about 127,000 downloads, Aladin , DS9 , GlueViz , and Ginga represent respectively 36%, 28%, 20%, and 8% percent of the total downloads. There seems to be some consensus on the interest of plugins to extend the possibilities of each software as only one software does not currently allow it. It also appears difficult for applications to incorporate the different listed functionality as native features. Most of the extensions need to be written in JAVA, some in Python, and DS9 allows to develop low-level plugins in basically any language as soon as it supports XPA or SAMP communication. The need for collaborative development DS9 lead developers remind that more bodies do not equal better results by citing Fred Brooks: \" the [software] design must proceed from one mind, or from a very small number of agreeing resonant minds \". Even though they believe that conceptual integrity requires a small team of developers, they face an expanding pressure due to the success of DS9 and confess spending 80% of their time in supporting users and maintaining/enhancing existing capabilities which leaves them with only 20% of time to innovate on new functionality. On the other side, I saw significant efforts in different teams to develop project-related processing tools and pipelines to analyze images, but they often are too specific to be re-used by the community and then stay within the collaboration that produced them. Agreeing with the fact that conceptual integrity requires a small team which unfortunately leads to much less time to innovate when the product gains maturity, it seems that the best compromise is the development of plugins by the community: This allows important and free innovation that will not break the software's concept/purpose Best interesting features/innovations that will emerge by themselves can then be merged into the initial software (as it has already been done for DS9 , GAIA ) This is particularly true in the open astronomy community where collaborative development becomes extremely popular This modularity and plugin philosophy is used by the majority of the top 10 open-source software: VLC , Libre Office , Firefox , Thunderbird , and by other fast-growing software: Nextcloud , Mattermost , Atom . This trend is similar for open-source image analysis software: GIMP , ImageJ , GINGA , Icy , Starlink , etc. Note A plugin is a software component or module designed to extend the functionality of an existing software application. The application architecture determines where and how plugins can be embedded (for example, reading or writing new formats, accessing and processing image data, etc.). Open-source software, in contrast to closed-source packages, often relies on plugins to foster contributions and expertise from the community Goals The goal is then to create a plugin that would fill the needs expressed above. The three different distant objectives that aim to make astronomers gain time are detailed below. Boosting interaction with scientific images The fact that astronomical data gets bigger is driving the way image software and pipelines are designed. It seems that the workforce is more directed towards developing specific applications (either project-specific : single-project-related pipelines, or big-data specific : web-hosted applications, neural-network-based analysis) rather than improving comprehensive applications working at the pixel layer and enhancing the interaction between the user and the data so that it can be used by a broader community. Specific applications listed above are important but will not fill the need that each astronomical project requires at some point a local and high-performance image processing software to work at the pixel level with improved interactivity. Current local and easy-to-use applications would still greatly benefit from enhanced interactivity and ergonomy. They represent an excellent test-bench opportunity to implement interactive features before spreading them to other more complex applications (such as web-based or big-data related). The plugin we present in this study will then focus on trying to develop interactive features. Note We call interaction a direct communication between the user and the software which is not only via the menu bar. All basic fits-viewers incorporate as native and interactive feature zooming, panning, rotating, changing scale limits. However, it could be pushed to the next level with, for instance, interaction with metadata (like regions of interest or catalogs), interactive detection and selection of sources, interactive plotting, and profile fitting, etc. Some work is ongoing to make some tools more interactive, but it is still in its infancy. Turning a visualization software into an image processing software Another aspect is that among all the fits-viewers, a minor fraction allows some image processing ( GAIA is the most advanced example but does not seem to gather a vast community, Icy for bio-images, AstroImageJ for light curves). Even though it is not their first purpose, this leaves almost no software to perform basic image processing (source extraction, background subtraction, radial profile, light curve, focus analysis, one-line interpreters, macros, etc.). Incorporating these features inside these fits-viewers might be premature at this stage as it could break the software concept integrity but spending time developing them as a plugin seems essential to make scientists earn time in their research. Building a code collaboration catalyst A byproduct of such plugins would be that people would not need to reinvent the wheel each time they need to perform some basic image processing like a radial profile. Such a plugin could be written to become a code collaboration catalyst which could then fill two important needs: Help people process images with less time or coding proficiency as they could lean on tested and ready-to-use image processing modules instead of making them code existing things. It could become a function aggregator for different types of structures (from the Ph.D. group of a given lab up to the astronomy community) where processing codes would be organized and maintained so that most of the written code within a lab stops disappearing each time a Ph.D. student leaves, or a senior researcher retires. The two issues (implementing existing code and losing unreleased code) represent a significant amount of time/knowledge/money loss. To make this possible the package: should be written in Python (because of the consensual implementation effort in this language in astronomy) as we aim to gather codes/community must be intelligible so that it can be easily re-appropriated and modifiable so that people can add functions to the extension allows running Macros directly The plugin we present in this study is a naive attempt to try to initiate this tendency and gather a glimpse of the main possibilities that fits-viewers plugins can offer. The choice of SAOImage DS9 SAOImage DS9 is an astronomical imaging and data visualization application. It gathers all of the other essential pieces of a modern fits viewer. Its 30 years of development has made it very stable and easy to use. Because of this, it became an essential tool in all fields of astronomy (observation, simulation, instrumentation). Much more profitable but pretty unsung feature; its extensibility makes it a limitless tool to interact with astronomical (or not) data. Unfortunately, it appears that this extensibility did not inspire or generate a large collaborative and well-organized effort to develop significant extensions that would finally, years after years, converge towards a stable/rapid/configurable DS9-affiliated package. The important strengths of DS9 that governed our choice are: Popularity: with ~35K downloads a year, DS9 belongs to the top two leaders in image visualization for astronomy. It also has the closest purpose to what we aim to develop (more image-focused than Aladin, even though it similarly accesses catalogs). It has a large enough community so that designing low-level plugins could work. Any language extensibility: DS9 architecture is set to accept plugins, coded in any language by just sending a Shell command. This is an essential strength in astronomy, where an unprecedented synergy occurs around Python language. Stability and simplicity: With a \" Keep it simple \" golden rule and 30 years of development, DS9 is incredibly simple and stable, which will help the development of our initiative. Indeed such initiatives can have downside effects such as fragmenting the existing community by requiring specific formating/language/etc. DS9 allows ultra-simple extensibility with quasi no format requirement as it simply sends background Shell commands that can call any extension and control the GUI. DS9 then seemed the perfect software to experiment such a plugin. Discussion and conclusion In this chapter, I tried to stress the need for astronomical image processing applications. I emphasize the different requirements of such an application and explain why Python extensions for already proven visualization software represent an exciting approach to address this need. Based on this, I introduced pyds9plugin , a scientific project I developed to illustrate this approach. This plugin has been developed from the ground up, paying attention to three particular aspects: addressing the need for image processing, enhancing the interaction between the user and the data, and catalyzing collaboration for processing functions. Writing DS9 plugins is an excellent way to develop data analysis pipelines and quality assurance tasks by leveraging the combination of the very efficient DS9 application and the burgeoning number of open-source astronomical Python modules. pyds9plugin gathers a glimpse of all possibilities offered by DS9 and stays, for now, a test bench to present such an approach. Even though it still has a considerable number of challenges to face: convince the future users, converge towards research-grade processing, scalability to larger datasets, etc., this chapter shows the ease of such an approach and its numerous benefits. Therefore, implementing processing codes this way generates a pretty high return on investment.","title":"Development philosophy"},{"location":"philosophy/#motivation","text":"Current fits viewer applications ( SAOImage DS9 , Aladin , GINGA , Glue ) have been developed to optimize the visualization of astronomical images while keeping some interesting specificities: linked-data exploration, interactive sky atlas access, flexible and extensible visualization toolkit, etc. Not initially designed for image processing, these applications do not address this need as it would break their conceptual integrity (by dispersing their purpose). This leaves it to big instrument consortiums who will design their own data processing pipeline, which will, most of the time, be too specific to be re-used by the astronomy community. For the particular discipline of astronomy evolving towards Jim Gray's fourth paradigm and where an essential part of the job relies on image analysis, the lack of processing codes draws a new challenge for current and future imaging software: mimicking what has been done for bioimage analysis by addressing the current frontier of image processing. Among the different difficulties that need to be addressed to make the processing software beneficial (catalyzing community collaboration and code enhancement, multi-image analysis, extensibility), one key aspect is to keep the essential high-level interactivity between the data and the user, which became a consensual feature for visualization. For various reasons that I will present, the development of plugins for fits viewer applications represents an exciting way to take up the challenge of developing image processing tools and address the related difficulties. I will then use introduce pyds9plugin : an attempt to design such a plugin. This DS9 quick look plugin is a public domain versatile extension I designed for DS9 visualization software. The plugin pushes DS9 visualization software a step further by allowing to analyze and process in real-time images while keeping a high level of interactivity. The processing functions can then be generalized automatically to a set of images to turn the quick-look tool into a multiprocessing pipeline. This plugin incorporates essential functions (radial profile, 2D/3D fitting, trough-focus, stacking, background removal, source/artifact extraction, etc.) to extract quantitative and intelligible information from imaging datasets in order to support instrumentation, reduce observations, analyze data performance, etc. We also linked the most famous astronomical codes ( SExtractor , Swarp , etc.) to the plugin to allow research-grade analysis and processing. As all researchers have different needs, the plugin is designed intelligibly to allow everyone to add their own macros that can then be run quickly and automatically on a set of images thanks to multiprocessing. This pyds9plugin , available both on Pypi and Github, tries to gather a glimpse of all the possibilities that offers DS9 extensibility so that it motivates astronomers exploring this development approach. This hybrid chapter aims at giving an overview of the achieved work.","title":"Motivation"},{"location":"philosophy/#existing-tools","text":"","title":"Existing tools"},{"location":"philosophy/#existing-tools-strengths-and-weaknesses","text":"The different main existing software for image visualization/processing are SAOImageDS9 , Aladin , Ginga and GlueViz . Some other non-astronomy-related image processing codes have developed astronomy plugins like ImageJ and Icy . Next Figure sum up each software approach and different characteristics as well as their different strengths and weaknesses in terms of image visualization and processing. On a total of about 127,000 downloads, Aladin , DS9 , GlueViz , and Ginga represent respectively 36%, 28%, 20%, and 8% percent of the total downloads. There seems to be some consensus on the interest of plugins to extend the possibilities of each software as only one software does not currently allow it. It also appears difficult for applications to incorporate the different listed functionality as native features. Most of the extensions need to be written in JAVA, some in Python, and DS9 allows to develop low-level plugins in basically any language as soon as it supports XPA or SAMP communication.","title":"Existing tools, strengths and weaknesses"},{"location":"philosophy/#the-need-for-collaborative-development","text":"DS9 lead developers remind that more bodies do not equal better results by citing Fred Brooks: \" the [software] design must proceed from one mind, or from a very small number of agreeing resonant minds \". Even though they believe that conceptual integrity requires a small team of developers, they face an expanding pressure due to the success of DS9 and confess spending 80% of their time in supporting users and maintaining/enhancing existing capabilities which leaves them with only 20% of time to innovate on new functionality. On the other side, I saw significant efforts in different teams to develop project-related processing tools and pipelines to analyze images, but they often are too specific to be re-used by the community and then stay within the collaboration that produced them. Agreeing with the fact that conceptual integrity requires a small team which unfortunately leads to much less time to innovate when the product gains maturity, it seems that the best compromise is the development of plugins by the community: This allows important and free innovation that will not break the software's concept/purpose Best interesting features/innovations that will emerge by themselves can then be merged into the initial software (as it has already been done for DS9 , GAIA ) This is particularly true in the open astronomy community where collaborative development becomes extremely popular This modularity and plugin philosophy is used by the majority of the top 10 open-source software: VLC , Libre Office , Firefox , Thunderbird , and by other fast-growing software: Nextcloud , Mattermost , Atom . This trend is similar for open-source image analysis software: GIMP , ImageJ , GINGA , Icy , Starlink , etc. Note A plugin is a software component or module designed to extend the functionality of an existing software application. The application architecture determines where and how plugins can be embedded (for example, reading or writing new formats, accessing and processing image data, etc.). Open-source software, in contrast to closed-source packages, often relies on plugins to foster contributions and expertise from the community","title":"The need for collaborative development"},{"location":"philosophy/#goals","text":"The goal is then to create a plugin that would fill the needs expressed above. The three different distant objectives that aim to make astronomers gain time are detailed below.","title":"Goals"},{"location":"philosophy/#boosting-interaction-with-scientific-images","text":"The fact that astronomical data gets bigger is driving the way image software and pipelines are designed. It seems that the workforce is more directed towards developing specific applications (either project-specific : single-project-related pipelines, or big-data specific : web-hosted applications, neural-network-based analysis) rather than improving comprehensive applications working at the pixel layer and enhancing the interaction between the user and the data so that it can be used by a broader community. Specific applications listed above are important but will not fill the need that each astronomical project requires at some point a local and high-performance image processing software to work at the pixel level with improved interactivity. Current local and easy-to-use applications would still greatly benefit from enhanced interactivity and ergonomy. They represent an excellent test-bench opportunity to implement interactive features before spreading them to other more complex applications (such as web-based or big-data related). The plugin we present in this study will then focus on trying to develop interactive features. Note We call interaction a direct communication between the user and the software which is not only via the menu bar. All basic fits-viewers incorporate as native and interactive feature zooming, panning, rotating, changing scale limits. However, it could be pushed to the next level with, for instance, interaction with metadata (like regions of interest or catalogs), interactive detection and selection of sources, interactive plotting, and profile fitting, etc. Some work is ongoing to make some tools more interactive, but it is still in its infancy.","title":"Boosting interaction with scientific images"},{"location":"philosophy/#turning-a-visualization-software-into-an-image-processing-software","text":"Another aspect is that among all the fits-viewers, a minor fraction allows some image processing ( GAIA is the most advanced example but does not seem to gather a vast community, Icy for bio-images, AstroImageJ for light curves). Even though it is not their first purpose, this leaves almost no software to perform basic image processing (source extraction, background subtraction, radial profile, light curve, focus analysis, one-line interpreters, macros, etc.). Incorporating these features inside these fits-viewers might be premature at this stage as it could break the software concept integrity but spending time developing them as a plugin seems essential to make scientists earn time in their research.","title":"Turning a visualization software into an image processing software"},{"location":"philosophy/#building-a-code-collaboration-catalyst","text":"A byproduct of such plugins would be that people would not need to reinvent the wheel each time they need to perform some basic image processing like a radial profile. Such a plugin could be written to become a code collaboration catalyst which could then fill two important needs: Help people process images with less time or coding proficiency as they could lean on tested and ready-to-use image processing modules instead of making them code existing things. It could become a function aggregator for different types of structures (from the Ph.D. group of a given lab up to the astronomy community) where processing codes would be organized and maintained so that most of the written code within a lab stops disappearing each time a Ph.D. student leaves, or a senior researcher retires. The two issues (implementing existing code and losing unreleased code) represent a significant amount of time/knowledge/money loss. To make this possible the package: should be written in Python (because of the consensual implementation effort in this language in astronomy) as we aim to gather codes/community must be intelligible so that it can be easily re-appropriated and modifiable so that people can add functions to the extension allows running Macros directly The plugin we present in this study is a naive attempt to try to initiate this tendency and gather a glimpse of the main possibilities that fits-viewers plugins can offer.","title":"Building a code collaboration catalyst"},{"location":"philosophy/#the-choice-of-saoimage-ds9","text":"SAOImage DS9 is an astronomical imaging and data visualization application. It gathers all of the other essential pieces of a modern fits viewer. Its 30 years of development has made it very stable and easy to use. Because of this, it became an essential tool in all fields of astronomy (observation, simulation, instrumentation). Much more profitable but pretty unsung feature; its extensibility makes it a limitless tool to interact with astronomical (or not) data. Unfortunately, it appears that this extensibility did not inspire or generate a large collaborative and well-organized effort to develop significant extensions that would finally, years after years, converge towards a stable/rapid/configurable DS9-affiliated package. The important strengths of DS9 that governed our choice are: Popularity: with ~35K downloads a year, DS9 belongs to the top two leaders in image visualization for astronomy. It also has the closest purpose to what we aim to develop (more image-focused than Aladin, even though it similarly accesses catalogs). It has a large enough community so that designing low-level plugins could work. Any language extensibility: DS9 architecture is set to accept plugins, coded in any language by just sending a Shell command. This is an essential strength in astronomy, where an unprecedented synergy occurs around Python language. Stability and simplicity: With a \" Keep it simple \" golden rule and 30 years of development, DS9 is incredibly simple and stable, which will help the development of our initiative. Indeed such initiatives can have downside effects such as fragmenting the existing community by requiring specific formating/language/etc. DS9 allows ultra-simple extensibility with quasi no format requirement as it simply sends background Shell commands that can call any extension and control the GUI. DS9 then seemed the perfect software to experiment such a plugin.","title":"The choice of SAOImage DS9"},{"location":"philosophy/#discussion-and-conclusion","text":"In this chapter, I tried to stress the need for astronomical image processing applications. I emphasize the different requirements of such an application and explain why Python extensions for already proven visualization software represent an exciting approach to address this need. Based on this, I introduced pyds9plugin , a scientific project I developed to illustrate this approach. This plugin has been developed from the ground up, paying attention to three particular aspects: addressing the need for image processing, enhancing the interaction between the user and the data, and catalyzing collaboration for processing functions. Writing DS9 plugins is an excellent way to develop data analysis pipelines and quality assurance tasks by leveraging the combination of the very efficient DS9 application and the burgeoning number of open-source astronomical Python modules. pyds9plugin gathers a glimpse of all possibilities offered by DS9 and stays, for now, a test bench to present such an approach. Even though it still has a considerable number of challenges to face: convince the future users, converge towards research-grade processing, scalability to larger datasets, etc., this chapter shows the ease of such an approach and its numerous benefits. Therefore, implementing processing codes this way generates a pretty high return on investment.","title":"Discussion and conclusion"},{"location":"user/","text":"Tutorials The plugin incorporates four tutorials to help the user understand how it works and guide him step by step throughout all the functions via specific test cases. They are accessible via DS9 menus. Analysis -> Quick look plugin -> Give it a go . The help is also available directly from the Analysis -> Quick look plugin -> Help","title":"Tutorials"},{"location":"user/#tutorials","text":"The plugin incorporates four tutorials to help the user understand how it works and guide him step by step throughout all the functions via specific test cases. They are accessible via DS9 menus. Analysis -> Quick look plugin -> Give it a go . The help is also available directly from the Analysis -> Quick look plugin -> Help","title":"Tutorials"},{"location":"videos/","text":"","title":"Videos"},{"location":"videos_generic/","text":"Explore image Python interpreter Interactive fitting Python macros Cosmological tool Create header database Filter images 3D image visualization 3D cube visualization Access through command line","title":"Generic"},{"location":"videos_generic/#explore-image","text":"","title":"Explore image"},{"location":"videos_generic/#python-interpreter","text":"","title":"Python interpreter"},{"location":"videos_generic/#interactive-fitting","text":"","title":"Interactive fitting"},{"location":"videos_generic/#python-macros","text":"","title":"Python macros"},{"location":"videos_generic/#cosmological-tool","text":"","title":"Cosmological tool"},{"location":"videos_generic/#create-header-database","text":"","title":"Create header database"},{"location":"videos_generic/#filter-images","text":"","title":"Filter images"},{"location":"videos_generic/#3d-image-visualization","text":"","title":"3D image visualization"},{"location":"videos_generic/#3d-cube-visualization","text":"","title":"3D cube visualization"},{"location":"videos_generic/#access-through-command-line","text":"","title":"Access through command line"},{"location":"videos_instru/","text":"Throughfocus analysis Radial profile 2D gaussian fitting Interactive fitting Python macros Create header database Explore image","title":"Instrumentation"},{"location":"videos_instru/#throughfocus-analysis","text":"","title":"Throughfocus analysis"},{"location":"videos_instru/#radial-profile","text":"","title":"Radial profile"},{"location":"videos_instru/#2d-gaussian-fitting","text":"","title":"2D gaussian fitting"},{"location":"videos_instru/#interactive-fitting","text":"","title":"Interactive fitting"},{"location":"videos_instru/#python-macros","text":"","title":"Python macros"},{"location":"videos_instru/#create-header-database","text":"","title":"Create header database"},{"location":"videos_instru/#explore-image","text":"","title":"Explore image"},{"location":"videos_multi/","text":"Multi image source extraction Python interpreter Python macros Multi image analysis Access through command line","title":"Multi-image processing"},{"location":"videos_multi/#multi-image-source-extraction","text":"","title":"Multi image source extraction"},{"location":"videos_multi/#python-interpreter","text":"","title":"Python interpreter"},{"location":"videos_multi/#python-macros","text":"","title":"Python macros"},{"location":"videos_multi/#multi-image-analysis","text":"","title":"Multi image analysis"},{"location":"videos_multi/#access-through-command-line","text":"","title":"Access through command line"},{"location":"videos_soft/","text":"Multi image source extraction Source extraction Cosmological tool STIFF Astrometry","title":"Software"},{"location":"videos_soft/#multi-image-source-extraction","text":"","title":"Multi image source extraction"},{"location":"videos_soft/#source-extraction","text":"","title":"Source extraction"},{"location":"videos_soft/#cosmological-tool","text":"","title":"Cosmological tool"},{"location":"videos_soft/#stiff","text":"","title":"STIFF"},{"location":"videos_soft/#astrometry","text":"","title":"Astrometry"}]}